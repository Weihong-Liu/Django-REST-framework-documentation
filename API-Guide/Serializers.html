

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>序列化器 (Serializers) &#8212; Django REST framework 中文文档</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'API-Guide/Serializers';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="序列化器字段 (Serializer fields)" href="Serializer-fields.html" />
    <link rel="prev" title="渲染器 (Renderers)" href="Renderers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Django REST framework 中文文档
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/Quickstart.html">快速开始</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/Serialization.html">教程 1：序列化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/Requests-and-Responses.html">教程 2：请求和响应</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/Class-based-views.html">教程 3：基于类的视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/Authentication-and-Permissions.html">教程 4：认证和权限</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/Relationships-and-Hyperlinked-APIs.html">教程 5：关系和超链接 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/ViewSets-and-Routers.html">教程 6：ViewSets ＆ Routers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/Schemas-and-client_libraries.html">教程 7：Schemas 和客户端库</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API-Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Requests.html">Requests</a></li>





<li class="toctree-l1"><a class="reference internal" href="Responses.html">响应 (Responses)</a></li>



<li class="toctree-l1"><a class="reference internal" href="Views.html">基于类的视图</a></li>

<li class="toctree-l1"><a class="reference internal" href="Generic-views.html">通用视图 (Generic views)</a></li>






<li class="toctree-l1"><a class="reference internal" href="Routers.html">Routers</a></li>



<li class="toctree-l1"><a class="reference internal" href="Parsers.html">解析器 (Parsers)</a></li>



<li class="toctree-l1"><a class="reference internal" href="Renderers.html">渲染器 (Renderers)</a></li>




<li class="toctree-l1 current active"><a class="current reference internal" href="#">序列化器 (Serializers)</a></li>






<li class="toctree-l1"><a class="reference internal" href="Serializer-fields.html">序列化器字段 (Serializer fields)</a></li>










<li class="toctree-l1"><a class="reference internal" href="Serializer-relations.html">序列化器关系 (Serializer relations)</a></li>






<li class="toctree-l1"><a class="reference internal" href="Validators.html">验证器 (Validators)</a></li>




<li class="toctree-l1"><a class="reference internal" href="Authentication.html">认证 (Authentication)</a></li>



<li class="toctree-l1"><a class="reference internal" href="Permissions.html">权限 (Permissions)</a></li>



<li class="toctree-l1"><a class="reference internal" href="Throttling.html">限流 (Throttling)</a></li>


<li class="toctree-l1"><a class="reference internal" href="Filtering.html">过滤 (Filtering)</a></li>




<li class="toctree-l1"><a class="reference internal" href="Pagination.html">分页 (Pagination)</a></li>




<li class="toctree-l1"><a class="reference internal" href="Versioning.html">版本控制 (Versioning)</a></li>


<li class="toctree-l1"><a class="reference internal" href="Content-negotiation.html">内容协商 (Content negotiation)</a></li>

<li class="toctree-l1"><a class="reference internal" href="Metadata.html">元数据 (Metadata)</a></li>


<li class="toctree-l1"><a class="reference internal" href="Schemas.html">模式 (Schemas)</a></li>





<li class="toctree-l1"><a class="reference internal" href="Format-suffixes.html">格式后缀 (Format suffixes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Returning-URLs.html">返回 URL (Returning URLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exceptions.html">异常 (Exceptions)</a></li>


<li class="toctree-l1"><a class="reference internal" href="Testing.html">测试 (Testing)</a></li>








<li class="toctree-l1"><a class="reference internal" href="Settings.html">设置 (Settings)</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Topics/Documenting_your_API.html">记录您的 API (Documenting your API)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Topics/API_Clients.html">API 客户端 (API Clients)</a></li>



<li class="toctree-l1"><a class="reference internal" href="../Topics/Internationalization.html">国际化 (Internationalization)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Topics/AJAX%2C_CSRF_%26_CORS.html">使用 AJAX，CSRF 和 CORS (Working with AJAX, CSRF &amp; CORS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Topics/HTML_%26_Forms.html">HTML 和表单 (HTML &amp; Forms)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Topics/The_Browsable_API.html">可浏览的 API (The Browsable API)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Topics/REST%2C_Hypermedia_%26_HATEOAS.html">REST, Hypermedia &amp; HATEOAS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Community/Tutorials_and_Resources.html">教程和资源 (Tutorials and Resources)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/Third_Party_Packages.html">第三方包 (Third Party Packages)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/Contributing_to_REST_framework.html">对 REST framework 的贡献 (Contributing to REST framework)</a></li>



<li class="toctree-l1"><a class="reference internal" href="../Community/Project_management.html">项目管理 (Project management)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/Release_Notes.html">发行说明 (Release Notes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.9_Announcement.html">Django REST framework 3.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.8_Announcement.html">Django REST framework 3.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.7_Announcement.html">Django REST framework 3.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.6_Announcement.html">Django REST framework 3.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.5_Announcement.html">Django REST framework 3.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.4_Announcement.html">Django REST framework 3.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.3_Announcement.html">Django REST framework 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.2_Announcement.html">Django REST framework 3.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.1_Announcement.html">Django REST framework 3.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/3.0_Announcement.html">Django REST framework 3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/Kickstarter_Announcement.html">Kickstarting Django REST framework 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/Mozilla_Grant.html">Mozilla Grant</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/Funding.html">资金 (Funding)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community/Jobs.html">工作 (Jobs)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FAPI-Guide/Serializers.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/API-Guide/Serializers.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>序列化器 (Serializers)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">序列化器 (Serializers)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#declaring-serializers">声明序列化器 (Declaring Serializers)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializing-objects">序列化对象 (Serializing objects)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deserializing-objects">反序列化对象 (Deserializing objects)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-instances">保存实例 (Saving instances)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-passing-additional-attributes-to-save">将附加属性传递给 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> (Passing additional attributes to <code class="docutils literal notranslate"><span class="pre">.save()</span></code>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-overriding-save-directly">直接重写 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> (Overriding <code class="docutils literal notranslate"><span class="pre">.save()</span></code> directly.)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">验证 (Validation)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raising-an-exception-on-invalid-data">引发无效数据的异常 (Raising an exception on invalid data)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#field-level-validation">字段级别验证 (Field-level validation)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#object-level-validation">对象级别验证 (Object-level validation)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validators">验证器 (Validators)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-initial-data-and-instance">访问初始数据和实例 (Accessing the initial data and instance)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-updates">部分更新 (Partial updates)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-nested-objects">处理嵌套对象 (Dealing with nested objects)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writable-nested-representations">可写的嵌套表示 (Writable nested representations)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-writing-create-methods-for-nested-representations">为嵌套表示编写 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 方法 (Writing <code class="docutils literal notranslate"><span class="pre">.create()</span></code> methods for nested representations)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-writing-update-methods-for-nested-representations">为嵌套表示编写 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法 (Writing <code class="docutils literal notranslate"><span class="pre">.update()</span></code> methods for nested representations)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-saving-related-instances-in-model-manager-classes">处理在模型管理类中保存关联实例 (Handling saving related instances in model manager classes)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-multiple-objects">处理多个对象 (Dealing with multiple objects)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#serializing-multiple-objects">序列化多个对象 (Serializing multiple objects)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deserializing-multiple-objects">反序列化多个对象 (Deserializing multiple objects)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#including-extra-context">包括额外的上下文 (Including extra context)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelserializer">ModelSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelserializer-inspecting-a-modelserializer">检查 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> (Inspecting a <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code>)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-which-fields-to-include">指定要包含的字段 (Specifying which fields to include)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-nested-serialization">指定嵌套序列化 (Specifying nested serialization)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-fields-explicitly">显式指定字段 (Specifying fields explicitly)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-read-only-fields">指定只读字段 (Specifying read only fields)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-keyword-arguments">附加关键字参数 (Additional keyword arguments)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-fields">关系字段 (Relational fields)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-field-mappings">自定义字段映射 (Customizing field mappings)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-field-class-field-kwargs-api">The field_class 和 field_kwargs API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperlinkedmodelserializer">HyperlinkedModelSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#url-absolute-and-relative-urls">绝对和相对 URL (Absolute and relative URLs)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-hyperlinked-views-are-determined">如何确定超链接视图 (How hyperlinked views are determined)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#url-changing-the-url-field-name">更改 URL 字段名称 (Changing the URL field name)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#listserializer">ListSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#listserializer-customizing-listserializer-behavior">自定义 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 行为 (Customizing <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> behavior)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-multiple-create">自定义多重创建 (Customizing multiple create)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-multiple-update">自定义多个更新 (Customizing multiple update)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#listserializer-customizing-listserializer-initialization">自定义 ListSerializer 初始化 (Customizing ListSerializer initialization)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#baseserializer">BaseSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseserializer-read-only-baseserializer-classes">只读 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类(Read-only <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> classes)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseserializer-read-write-baseserializer-classes">读写 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类 (Read-write <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> classes)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-base-classes">创建新的基类 (Creating new base classes)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-serializer-usage">高级序列化器用法 (Advanced serializer usage)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overriding-serialization-and-deserialization-behavior">重写序列化和反序列化行为 (Overriding serialization and deserialization behavior)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializer-inheritance">序列化器继承 (Serializer Inheritance)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamically-modifying-fields">动态修改字段 (Dynamically modifying fields)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">举个栗子</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-the-default-fields">自定义默认字段 (Customizing the default fields)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#third-party-packages">第三方包 (Third party packages)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#django-rest-marshmallow">Django REST marshmallow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serpy">Serpy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mongoenginemodelserializer">MongoengineModelSerializer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geofeaturemodelserializer">GeoFeatureModelSerializer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hstoreserializer">HStoreSerializer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-rest">Dynamic REST</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-fields-mixin">Dynamic Fields Mixin</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drf-flexfields">DRF FlexFields</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializer-extensions">Serializer Extensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#html-json-forms">HTML JSON Forms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drf-base64">DRF-Base64</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#queryfields">QueryFields</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drf-writable-nested">DRF Writable Nested</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="serializers">
<h1>序列化器 (Serializers)<a class="headerlink" href="#serializers" title="Permalink to this heading">#</a></h1>
<p>扩展序列化器的有用性是我们想要解决的问题。然而，这不是一个微不足道的问题，它将需要一些严肃的设计工作。—— Russell Keith-Magee, Django 用户组</p>
<p>序列化器允许将复杂数据 (如查询集和模型实例) 转换为可以轻松渲染成 <code class="docutils literal notranslate"><span class="pre">JSON</span></code>，<code class="docutils literal notranslate"><span class="pre">XML</span></code> 或其他内容类型的原生 Python 数据类型。序列化器还提供反序列化，在验证传入的数据之后允许解析数据转换回复杂类型。</p>
<p>REST framework 中的序列化器与 Django 的 <code class="docutils literal notranslate"><span class="pre">Form</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> 类非常相似。我们提供了一个 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类，它为您提供了强大的、通用的方法来控制响应的输出，以及一个 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 类，它为创建用于处理模型实例和查询集的序列化器提供了有用的快捷实现方式。</p>
<section id="declaring-serializers">
<h2>声明序列化器 (Declaring Serializers)<a class="headerlink" href="#declaring-serializers" title="Permalink to this heading">#</a></h2>
<p>让我们从创建一个我们可以用于示例目的的简单对象开始：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">created</span> <span class="ow">or</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">comment</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="s1">&#39;leila@example.com&#39;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s1">&#39;foo bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>我们将声明一个序列化器，我们可以使用它来序列化和反序列化与 <code class="docutils literal notranslate"><span class="pre">Comment</span></code> 对象相应的数据。</p>
<p>声明序列化器看起来与声明表单非常相似：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="k">class</span> <span class="nc">CommentSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="serializing-objects">
<h2>序列化对象 (Serializing objects)<a class="headerlink" href="#serializing-objects" title="Permalink to this heading">#</a></h2>
<p>我们现在可以使用 <code class="docutils literal notranslate"><span class="pre">CommentSerializer</span></code> 来序列化 comment 或 comment 列表。同样，使用 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类看起来很像使用 <code class="docutils literal notranslate"><span class="pre">Form</span></code> 类。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">CommentSerializer</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># {&#39;email&#39;: &#39;leila@example.com&#39;, &#39;content&#39;: &#39;foo bar&#39;, &#39;created&#39;: &#39;2016-01-27T15:17:10.375877&#39;}</span>
</pre></div>
</div>
<p>此时，我们已将模型实例转换为 Python 原生的数据类型。为了完成序列化过程，我们将数据渲染为 <code class="docutils literal notranslate"><span class="pre">json</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework.renderers</span> <span class="kn">import</span> <span class="n">JSONRenderer</span>

<span class="n">json</span> <span class="o">=</span> <span class="n">JSONRenderer</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">json</span>
<span class="c1"># b&#39;{&quot;email&quot;:&quot;leila@example.com&quot;,&quot;content&quot;:&quot;foo bar&quot;,&quot;created&quot;:&quot;2016-01-27T15:17:10.375877&quot;}&#39;</span>
</pre></div>
</div>
</section>
<section id="deserializing-objects">
<h2>反序列化对象 (Deserializing objects)<a class="headerlink" href="#deserializing-objects" title="Permalink to this heading">#</a></h2>
<p>反序列化是类似的。首先我们将一个流解析为 Python 原生的数据类型…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.six</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">rest_framework.parsers</span> <span class="kn">import</span> <span class="n">JSONParser</span>

<span class="n">stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</pre></div>
</div>
<p>…然后我们将这些原生数据类型恢复为验证数据的字典。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">CommentSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="c1"># True</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">validated_data</span>
<span class="c1"># {&#39;content&#39;: &#39;foo bar&#39;, &#39;email&#39;: &#39;leila@example.com&#39;, &#39;created&#39;: datetime.datetime(2012, 08, 22, 16, 20, 09, 822243)}</span>
</pre></div>
</div>
</section>
<section id="saving-instances">
<h2>保存实例 (Saving instances)<a class="headerlink" href="#saving-instances" title="Permalink to this heading">#</a></h2>
<p>如果我们希望能够返回基于验证数据的完整对象实例，我们需要实现 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">update()</span></code> 方法中的一个或全部。举个栗子：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommentSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Comment</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">created</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>
</pre></div>
</div>
<p>如果您的对象实例对应于 Django 模型，您还需要确保这些方法将对象保存到数据库。例如，如果 <code class="docutils literal notranslate"><span class="pre">Comment</span></code> 是 Django 模型，则方法可能如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>	<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">created</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">instance</span>
</pre></div>
</div>
<p>现在，在反序列化数据时，根据验证的数据我们可以调用 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> 返回一个对象实例。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">comment</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>调用 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> 方法将创建新实例或者更新现有实例，具体取决于实例化序列化器类时是否传递了现有实例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># .save() will create a new instance.</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">CommentSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># .save() will update the existing `comment` instance.</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">CommentSerializer</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法都是可选的。你可以根据你序列化器类的用例不实现、或实现其中一个或都实现。</p>
<section id="save-passing-additional-attributes-to-save">
<h3>将附加属性传递给 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> (Passing additional attributes to <code class="docutils literal notranslate"><span class="pre">.save()</span></code>)<a class="headerlink" href="#save-passing-additional-attributes-to-save" title="Permalink to this heading">#</a></h3>
<p>有时您会希望您的视图代码能够在保存实例时注入额外的数据。此额外数据可能包括当前用户，当前时间或不是请求数据一部分的其他信息。</p>
<p>您可以通过在调用 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> 时包含其他关键字参数来执行此操作。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 被调用时，任何其他关键字参数将被包含在 <code class="docutils literal notranslate"><span class="pre">validated_data</span></code> 参数中。</p>
</section>
<section id="save-overriding-save-directly">
<h3>直接重写 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> (Overriding <code class="docutils literal notranslate"><span class="pre">.save()</span></code> directly.)<a class="headerlink" href="#save-overriding-save-directly" title="Permalink to this heading">#</a></h3>
<p>在某些情况下，<code class="docutils literal notranslate"><span class="pre">.create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法名称可能没有意义。例如在 contact form 中，我们可能不会创建新的实例，而是发送电子邮件或其他消息。</p>
<p>在这些情况下，您可以选择直接重写 <code class="docutils literal notranslate"><span class="pre">.save()</span></code>，因为这样更具有可读性和意义。</p>
<p>举个栗子：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ContactForm</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
        <span class="n">send_email</span><span class="p">(</span><span class="n">from</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>请注意，在上面的情况下，我们现在必须直接访问序列化器 <code class="docutils literal notranslate"><span class="pre">.validated_data</span></code> 属性。</p>
</section>
</section>
<section id="validation">
<h2>验证 (Validation)<a class="headerlink" href="#validation" title="Permalink to this heading">#</a></h2>
<p>在反序列化数据时，在尝试访问经过验证的数据或保存对象实例之前，总是需要调用 <code class="docutils literal notranslate"><span class="pre">is_valid()</span></code>。如果发生任何验证错误，<code class="docutils literal notranslate"><span class="pre">.errors</span></code> 属性将包含表示结果错误消息的字典。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">CommentSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="s1">&#39;baz&#39;</span><span class="p">})</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="c1"># False</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">errors</span>
<span class="c1"># {&#39;email&#39;: [u&#39;Enter a valid e-mail address.&#39;], &#39;created&#39;: [u&#39;This field is required.&#39;]}</span>
</pre></div>
</div>
<p>字典中的每个键都是字段名称，值是与该字段对应的任何错误消息的字符串列表。<code class="docutils literal notranslate"><span class="pre">non_field_errors</span></code> 键也可能存在，并将列出任何常规验证错误。可以使用 REST framework 设置中的 <code class="docutils literal notranslate"><span class="pre">NON_FIELD_ERRORS_KEY</span></code> 来自定义 <code class="docutils literal notranslate"><span class="pre">non_field_errors</span></code>  键的名称。</p>
<p>当反序列化项目列表时，错误将作为表示每个反序列化项目的字典列表返回。</p>
<section id="raising-an-exception-on-invalid-data">
<h3>引发无效数据的异常 (Raising an exception on invalid data)<a class="headerlink" href="#raising-an-exception-on-invalid-data" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.is_valid()</span></code> 方法使用可选的 <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> 标志，如果存在验证错误，将会抛出 <code class="docutils literal notranslate"><span class="pre">serializers.ValidationError</span></code> 异常。</p>
<p>这些异常由 REST framework 提供的默认异常处理程序自动处理，默认情况下将返回 <code class="docutils literal notranslate"><span class="pre">HTTP</span> <span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code> 响应。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Return a 400 response if the data was invalid.</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="field-level-validation">
<h3>字段级别验证 (Field-level validation)<a class="headerlink" href="#field-level-validation" title="Permalink to this heading">#</a></h3>
<p>您可以通过向您的 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 子类中添加 <code class="docutils literal notranslate"><span class="pre">.validate_&lt;field_name&gt;</span></code> 方法来指定自定义字段级的验证。这些类似于 Django 表单中的 <code class="docutils literal notranslate"><span class="pre">.clean_&lt;field_name&gt;</span></code> 方法。</p>
<p>这些方法采用单个参数，即需要验证的字段值。</p>
<p>您的 <code class="docutils literal notranslate"><span class="pre">validate_&lt;field_name&gt;</span></code> 方法应该返回已验证的值或者抛出 <code class="docutils literal notranslate"><span class="pre">serializers.ValidationError</span></code> 异常。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="k">class</span> <span class="nc">BlogPostSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validate_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that the blog post is about Django.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;django&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Blog post is not about Django&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<hr class="docutils" />
<p>注意：如果在您的序列化器上声明了 <code class="docutils literal notranslate"><span class="pre">&lt;field_name&gt;</span></code> 的参数为 <code class="docutils literal notranslate"><span class="pre">required=False</span></code>，那么如果不包含该字段，则此验证步骤不会发生。</p>
<hr class="docutils" />
</section>
<section id="object-level-validation">
<h3>对象级别验证 (Object-level validation)<a class="headerlink" href="#object-level-validation" title="Permalink to this heading">#</a></h3>
<p>要执行需要访问多个字段的任何其他验证，请添加名为 <code class="docutils literal notranslate"><span class="pre">.validate()</span></code> 的方法到您的 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 子类中。此方法采用单个参数，该参数是字段值的字典。如果需要，它应该抛出 <code class="docutils literal notranslate"><span class="pre">ValidationError</span></code> 异常，或者只返回经过验证的值。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="k">class</span> <span class="nc">EventSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">finish</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that the start is before the stop.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;finish&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;finish must occur after start&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</section>
<section id="validators">
<h3>验证器 (Validators)<a class="headerlink" href="#validators" title="Permalink to this heading">#</a></h3>
<p>序列化器上的各个字段都可以包含验证器，通过在字段实例上声明，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiple_of_ten</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Not a multiple of ten&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GameRecord</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">multiple_of_ten</span><span class="p">])</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>序列化器类还可以包括应用于完整字段数据集的可重用验证器。通过在内部 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 类上声明来包含这些验证器，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EventSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">room_number</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">201</span><span class="p">])</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c1"># Each room only has one event per day.</span>
        <span class="n">validators</span> <span class="o">=</span> <span class="n">UniqueTogetherValidator</span><span class="p">(</span>
            <span class="n">queryset</span><span class="o">=</span><span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;room_number&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>有关更多信息，请参阅<a class="reference external" href="http://www.django-rest-framework.org/api-guide/validators/">验证器文档</a>。</p>
</section>
</section>
<section id="accessing-the-initial-data-and-instance">
<h2>访问初始数据和实例 (Accessing the initial data and instance)<a class="headerlink" href="#accessing-the-initial-data-and-instance" title="Permalink to this heading">#</a></h2>
<p>将初始化对象或者查询集传递给序列化器实例时，该对象将以 <code class="docutils literal notranslate"><span class="pre">.instance</span></code> 的形式提供。如果没有传递初始化对象，那么 <code class="docutils literal notranslate"><span class="pre">.instance</span></code> 属性将是 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
<p>将数据传递给序列化器实例时，未修改的数据将以 <code class="docutils literal notranslate"><span class="pre">.initial_data</span></code> 的形式提供。如果 data 关键字参数未被传递，那么 <code class="docutils literal notranslate"><span class="pre">.initial_data</span></code> 属性将不存在。</p>
</section>
<section id="partial-updates">
<h2>部分更新 (Partial updates)<a class="headerlink" href="#partial-updates" title="Permalink to this heading">#</a></h2>
<p>默认情况下，序列化器必须传递所有必填字段的值，否则就会引发验证错误。您可以使用 <code class="docutils literal notranslate"><span class="pre">partial</span></code> 参数以允许部分更新。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update `comment` with partial data</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">CommentSerializer</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;foo bar&#39;</span><span class="p">},</span> <span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dealing-with-nested-objects">
<h2>处理嵌套对象 (Dealing with nested objects)<a class="headerlink" href="#dealing-with-nested-objects" title="Permalink to this heading">#</a></h2>
<p>前面的示例适用于处理只有简单数据类型的对象，但有时我们还需要能够代表更复杂的物体，其中对象的某些属性可能不是字符串、日期、整数这样简单的数据类型。</p>
<p><code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类本身也是一种 <code class="docutils literal notranslate"><span class="pre">Field</span></code>，并且可以用来表示一个对象类型嵌套在另一个对象类型中的关系。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CommentSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">()</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</pre></div>
</div>
<p>如果嵌套表示可以可选地接受 <code class="docutils literal notranslate"><span class="pre">None</span></code> 值，则应将 <code class="docutils literal notranslate"><span class="pre">required=False</span></code> 标志传递给嵌套的序列化器。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommentSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># May be an anonymous user.</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</pre></div>
</div>
<p>类似地，如果嵌套表示应该是项目列表，则应将 <code class="docutils literal notranslate"><span class="pre">many</span> <span class="pre">=</span> <span class="pre">True</span></code> 标志传递给嵌套的序列化器。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommentSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">edits</span> <span class="o">=</span> <span class="n">EditItemSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># A nested list of &#39;edit&#39; items.</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="writable-nested-representations">
<h2>可写的嵌套表示 (Writable nested representations)<a class="headerlink" href="#writable-nested-representations" title="Permalink to this heading">#</a></h2>
<p>处理支持反序列化数据的嵌套表示时，嵌套对象的任何错误都将嵌套在嵌套对象的字段名称下。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">CommentSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;doe&#39;</span><span class="p">},</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="s1">&#39;baz&#39;</span><span class="p">})</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="c1"># False</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">errors</span>
<span class="c1"># {&#39;user&#39;: {&#39;email&#39;: [u&#39;Enter a valid e-mail address.&#39;]}, &#39;created&#39;: [u&#39;This field is required.&#39;]}</span>
</pre></div>
</div>
<p>类似的，<code class="docutils literal notranslate"><span class="pre">.validated_data</span></code> 属性将包含嵌套数据结构。</p>
<section id="create-writing-create-methods-for-nested-representations">
<h3>为嵌套表示编写 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 方法 (Writing <code class="docutils literal notranslate"><span class="pre">.create()</span></code> methods for nested representations)<a class="headerlink" href="#create-writing-create-methods-for-nested-representations" title="Permalink to this heading">#</a></h3>
<p>如果您支持可写的嵌套表示，则需要编写处理保存多个对象的 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法。</p>
<p>下面的示例演示了如何处理嵌套的配置文件对象创建用户。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileSerializer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;profile&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">profile_data</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="o">**</span><span class="n">profile_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
</section>
<section id="update-writing-update-methods-for-nested-representations">
<h3>为嵌套表示编写 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法 (Writing <code class="docutils literal notranslate"><span class="pre">.update()</span></code> methods for nested representations)<a class="headerlink" href="#update-writing-update-methods-for-nested-representations" title="Permalink to this heading">#</a></h3>
<p>对于更新，您需要仔细考虑如何处理关系更新。例如，如果关系的数据为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 或未提供，则应发生以下哪种情况？</p>
<ul class="simple">
<li><p>在数据库中将关系设置为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>。</p></li>
<li><p>删除关联的实例。</p></li>
<li><p>忽略数据并保留这个实例。</p></li>
<li><p>抛出验证错误。</p></li>
</ul>
<p>这是我们之前 <code class="docutils literal notranslate"><span class="pre">UserSerializer</span></code> 类中 <code class="docutils literal notranslate"><span class="pre">update()</span></code> 方法的示例。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">profile_data</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>
        <span class="c1"># 除非应用程序正确地强制始终设置该字段，否则就应该抛出一个需要处理的`DoesNotExist`。</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">profile</span>

        <span class="n">instance</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">profile</span><span class="o">.</span><span class="n">is_premium_member</span> <span class="o">=</span> <span class="n">profile_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;is_premium_member&#39;</span><span class="p">,</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">is_premium_member</span>
        <span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">has_support_contract</span> <span class="o">=</span> <span class="n">profile_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;has_support_contract&#39;</span><span class="p">,</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">has_support_contract</span>
         <span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">instance</span>
</pre></div>
</div>
<p>因为嵌套创建和更新的行为可能不明确，并且可能需要相关模型之间的复杂依赖关系，REST framework 3 要求你始终显式的编写这些方法。默认的 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法不包括对可写嵌套表示的支持。</p>
<p>但是，可用的第三方软件包 (如 <a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#drf-writable-nested">DRF Writable Nested</a>) 支持自动可写嵌套表示。</p>
</section>
<section id="handling-saving-related-instances-in-model-manager-classes">
<h3>处理在模型管理类中保存关联实例 (Handling saving related instances in model manager classes)<a class="headerlink" href="#handling-saving-related-instances-in-model-manager-classes" title="Permalink to this heading">#</a></h3>
<p>在序列化器中保存多个相关实例的另一种方法是编写处理创建正确实例的自定义模型管理器类。</p>
<p>例如，假设我们希望确保User实例和Profile实例始终作为一对一起创建。我们可能会编写一个类似于下面的自定义管理器类：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">is_premium_member</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">has_support_contract</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">is_premium_member</span><span class="o">=</span><span class="n">is_premium_member</span><span class="p">,</span>
            <span class="n">has_support_contract</span><span class="o">=</span><span class="n">has_support_contract</span>
        <span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
<p>此管理器类现在更好地封装了 user 实例和 profile 实例始终同时创建。现在可以重写我们在序列化程序类上的 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 方法以使用新的管理器方法。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">username</span><span class="o">=</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
        <span class="n">email</span><span class="o">=</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
        <span class="n">is_premium_member</span><span class="o">=</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">][</span><span class="s1">&#39;is_premium_member&#39;</span><span class="p">]</span>
        <span class="n">has_support_contract</span><span class="o">=</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">][</span><span class="s1">&#39;has_support_contract&#39;</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>有关此方法的更多详细信息，请参阅<a class="reference external" href="https://docs.djangoproject.com/en/stable/topics/db/managers/">模型管理器</a>上的 Django 文档，以及<a class="reference external" href="https://www.dabapps.com/blog/django-models-and-encapsulation/">使用模型和管理器类的相关博客</a>。</p>
</section>
</section>
<section id="dealing-with-multiple-objects">
<h2>处理多个对象 (Dealing with multiple objects)<a class="headerlink" href="#dealing-with-multiple-objects" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类还可以处理序列化或反序列化对象列表。</p>
<section id="serializing-multiple-objects">
<h3>序列化多个对象 (Serializing multiple objects)<a class="headerlink" href="#serializing-multiple-objects" title="Permalink to this heading">#</a></h3>
<p>要序列化查询集或对象列表而不是单个对象实例，应在实例化序列化器时传递 <code class="docutils literal notranslate"><span class="pre">many</span> <span class="pre">=</span> <span class="pre">True</span></code> 标志。然后，您可以传递要序列化的查询集或对象列表。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">BookSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># [</span>
<span class="c1">#     {&#39;id&#39;: 0, &#39;title&#39;: &#39;The electric kool-aid acid test&#39;, &#39;author&#39;: &#39;Tom Wolfe&#39;},</span>
<span class="c1">#     {&#39;id&#39;: 1, &#39;title&#39;: &#39;If this is a man&#39;, &#39;author&#39;: &#39;Primo Levi&#39;},</span>
<span class="c1">#     {&#39;id&#39;: 2, &#39;title&#39;: &#39;The wind-up bird chronicle&#39;, &#39;author&#39;: &#39;Haruki Murakami&#39;}</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</section>
<section id="deserializing-multiple-objects">
<h3>反序列化多个对象 (Deserializing multiple objects)<a class="headerlink" href="#deserializing-multiple-objects" title="Permalink to this heading">#</a></h3>
<p>反序列化多个对象的默认行为是支持多个对象创建，但不支持多个对象更新。有关如何支持或自定义这些情况的更多信息，请参阅下面的 <a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#listserializer">ListSerializer</a> 文档。</p>
</section>
</section>
<section id="including-extra-context">
<h2>包括额外的上下文 (Including extra context)<a class="headerlink" href="#including-extra-context" title="Permalink to this heading">#</a></h2>
<p>在某些情况下，除了要序列化的对象之外，还需要为序列化器提供额外的上下文。一种常见的情况是，如果您正在使用包含超链接关系的序列化器，这需要序列化器能够访问当前的请求以便正确生成完全限定的 URL。</p>
<p>您可以通过在实例化序列化器时传递 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数来提供任意的附加上下文。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">AccountSerializer</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># {&#39;id&#39;: 6, &#39;owner&#39;: u&#39;denvercoder9&#39;, &#39;created&#39;: datetime.datetime(2013, 2, 12, 09, 44, 56, 678870), &#39;details&#39;: &#39;http://example.com/accounts/6/details&#39;}</span>
</pre></div>
</div>
<p>通过访问 <code class="docutils literal notranslate"><span class="pre">self.context</span></code> 属性，可以在任何序列化器字段逻辑中使用上下文字典，例如自定义的 <code class="docutils literal notranslate"><span class="pre">.to_representation()</span></code> 方法。</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="modelserializer">
<h1>ModelSerializer<a class="headerlink" href="#modelserializer" title="Permalink to this heading">#</a></h1>
<p>通常，您会希望序列化器类紧密地映射到 Django 模型定义上。</p>
<p><code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 类提供了一个快捷方式，可以自动创建具有与模型字段对应的字段的 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类。</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 类与常规 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类相同，不同之处在于</strong>：</p>
<ul class="simple">
<li><p>它将根据模型自动为您生成一组字段。</p></li>
<li><p>它将自动为序列化器生成验证器，例如 unique_together 验证器。</p></li>
<li><p>它包含默认简单实现的 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法。</p></li>
</ul>
<p>声明 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;account_name&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>默认情况下，类上的所有模型字段都将映射到相应的序列化器字段。</p>
<p>模型上的任何关系如 (外键) 都将映射到 <code class="docutils literal notranslate"><span class="pre">PrimaryKeyRelatedField</span></code>。默认情况下不包括反向关系，除非在<a class="reference external" href="http://www.django-rest-framework.org/api-guide/relations/">序列化关系</a>文档中明确包含指定。</p>
<section id="modelserializer-inspecting-a-modelserializer">
<h2>检查 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> (Inspecting a <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code>)<a class="headerlink" href="#modelserializer-inspecting-a-modelserializer" title="Permalink to this heading">#</a></h2>
<p>序列化器类生成有用的详细表示字符串，允许您全面检查其字段的状态。在使用 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 时特别有用，因为您想确定为您自动创建了哪些字段和验证器。</p>
<p>为此，使用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">shell</span></code> 打开 Django shell，然后导入序列化器类，实例化它，并打印对象的表示…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.serializers</span> <span class="kn">import</span> <span class="n">AccountSerializer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">serializer</span> <span class="o">=</span> <span class="n">AccountSerializer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">serializer</span><span class="p">))</span>
<span class="go">AccountSerializer():</span>
<span class="go">    id = IntegerField(label=&#39;ID&#39;, read_only=True)</span>
<span class="go">    name = CharField(allow_blank=True, max_length=100, required=False)</span>
<span class="go">    owner = PrimaryKeyRelatedField(queryset=User.objects.all())</span>
</pre></div>
</div>
</section>
<section id="specifying-which-fields-to-include">
<h2>指定要包含的字段 (Specifying which fields to include)<a class="headerlink" href="#specifying-which-fields-to-include" title="Permalink to this heading">#</a></h2>
<p>如果您只想在模型序列化器中使用默认字段的子集，则可以使用 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 或 <code class="docutils literal notranslate"><span class="pre">exclude</span></code> 选项，就像使用 <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> 一样。强烈建议您使用 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 属性显式设置应序列化的所有字段。这将使得在模型更改时不太可能导致无意中暴露数据。</p>
<p>举个栗子：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;account_name&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>你还可以将 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 属性设置成 <code class="docutils literal notranslate"><span class="pre">'__all__'</span></code> 来表明使用模型中的所有字段。</p>
<p>举个栗子：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s1">&#39;__all__&#39;</span>
</pre></div>
</div>
<p>你可以将 <code class="docutils literal notranslate"><span class="pre">exclude</span></code> 属性设置为从序列化器中排除的字段列表。</p>
<p>举个栗子：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>在上面的例子中，如果 <code class="docutils literal notranslate"><span class="pre">Account</span></code> 模型有三个字段 <code class="docutils literal notranslate"><span class="pre">account_name</span></code>，<code class="docutils literal notranslate"><span class="pre">users</span></code> 和 <code class="docutils literal notranslate"><span class="pre">created</span></code>，那么只有 <code class="docutils literal notranslate"><span class="pre">account_name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">created</span></code> 会被序列化。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 和 <code class="docutils literal notranslate"><span class="pre">exclude</span></code> 属性中的名称，通常会映射到模型类中的模型字段。</p>
<p>或者，<code class="docutils literal notranslate"><span class="pre">fields</span></code> 选项中的名称可以映射到不包含模型类中存在的参数的属性或方法。</p>
<p>从版本 3.3.0 开始，必须提供其中一个属性 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 或 <code class="docutils literal notranslate"><span class="pre">exclude</span></code>。</p>
</section>
<section id="specifying-nested-serialization">
<h2>指定嵌套序列化 (Specifying nested serialization)<a class="headerlink" href="#specifying-nested-serialization" title="Permalink to this heading">#</a></h2>
<p>默认的 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 使用主键进行关联，但您也可以使用 <code class="docutils literal notranslate"><span class="pre">depth</span></code> 选项轻松的生成嵌套关联：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;account_name&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">)</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">depth</span></code> 选项应设置为一个整数值，该值指示在恢复为平面表示之前应该遍历的关系深度。(后半句没看懂！！！)</p>
<p>如果要自定义序列化的方式，则需要自己定义字段。</p>
</section>
<section id="specifying-fields-explicitly">
<h2>显式指定字段 (Specifying fields explicitly)<a class="headerlink" href="#specifying-fields-explicitly" title="Permalink to this heading">#</a></h2>
<p>您可以向 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 添加额外字段，或通过在类上声明字段来重写默认字段，就像对 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类一样。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;get_absolute_url&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">PrimaryKeyRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
</pre></div>
</div>
<p>额外的字段可以对应模型上任何属性或可调用的 (字段)。</p>
</section>
<section id="specifying-read-only-fields">
<h2>指定只读字段 (Specifying read only fields)<a class="headerlink" href="#specifying-read-only-fields" title="Permalink to this heading">#</a></h2>
<p>您可能希望将多个字段指定为只读。您可以使用快捷的 Meta 选项 <code class="docutils literal notranslate"><span class="pre">read_only_fields</span></code>，而不是使用 <code class="docutils literal notranslate"><span class="pre">read_only=True</span></code> 属性显式的添加每个字段。</p>
<p>该选项应该是字段名称的列表或元组，并声明如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;account_name&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">)</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;account_name&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>模型中已经设置 <code class="docutils literal notranslate"><span class="pre">editable=False</span></code> 的字段和默认就被设置为只读的 <code class="docutils literal notranslate"><span class="pre">AutoField</span></code> 字段都不需要添加到 <code class="docutils literal notranslate"><span class="pre">read_only_fields</span></code> 选项中。</p>
<hr class="docutils" />
<p><strong>注意</strong>：有一种特殊情况，其中只读字段是模型级别 <code class="docutils literal notranslate"><span class="pre">unique_together</span></code> 约束的一部分。在这种情况下，序列化器类需要该字段来验证约束，但也不能由用户编辑。</p>
<p>处理该问题的正确方法是在序列化器上显式指定该字段，同时提供 <code class="docutils literal notranslate"><span class="pre">read_only=True</span></code> 和 <code class="docutils literal notranslate"><span class="pre">default=…</span></code> 关键字参数。</p>
<p>其中一个例子是与当前已认证 <code class="docutils literal notranslate"><span class="pre">User</span></code> 的只读关系，它与另一个标识符是 <code class="docutils literal notranslate"><span class="pre">unique_together</span></code>。在这种情况下，您可以声明用户字段，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">PrimaryKeyRelatedField</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">serializers</span><span class="o">.</span><span class="n">CurrentUserDefault</span><span class="p">())</span>
</pre></div>
</div>
<p>有关 <a class="reference external" href="http://www.django-rest-framework.org/api-guide/validators/#uniquetogethervalidator">UniqueTogetherValidator</a> 和 <a class="reference external" href="http://www.django-rest-framework.org/api-guide/validators/#currentuserdefault">CurrentUserDefault</a> 类的详细文档，请查阅<a class="reference external" href="http://www.django-rest-framework.org/api-guide/validators/">验证器文档</a>。</p>
</section>
<hr class="docutils" />
<section id="additional-keyword-arguments">
<h2>附加关键字参数 (Additional keyword arguments)<a class="headerlink" href="#additional-keyword-arguments" title="Permalink to this heading">#</a></h2>
<p>还有一个快捷方式允许您使用 <code class="docutils literal notranslate"><span class="pre">extra_kwargs</span></code> 选项在字段上指定任意附加关键字参数。与  <code class="docutils literal notranslate"><span class="pre">read_only_fields</span></code> 的情况一样，这意味着您不需要在序列化器中显式声明该字段。</p>
<p>此选项是一个字典，将字段名称映射到关键字参数的字典。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CreateUserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>
        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;write_only&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span>
            <span class="n">email</span><span class="o">=</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
            <span class="n">username</span><span class="o">=</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">validated_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
</section>
<section id="relational-fields">
<h2>关系字段 (Relational fields)<a class="headerlink" href="#relational-fields" title="Permalink to this heading">#</a></h2>
<p>序列化模型实例时，您可以选择多种不同的方式来表示关联关系。<code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 的默认表示是使用相关实例的主键。</p>
<p>替代表示方式包括使用超链接序列化，序列化完整的嵌套表示或者使用自定义表示的序列化。</p>
<p>有关详细信息，请参阅<a class="reference external" href="http://www.django-rest-framework.org/api-guide/relations/">序列化器关系</a>文档。</p>
</section>
<section id="customizing-field-mappings">
<h2>自定义字段映射 (Customizing field mappings)<a class="headerlink" href="#customizing-field-mappings" title="Permalink to this heading">#</a></h2>
<p>ModelSerializer 类还公开了一个可以重写的 API，以便在实例化序列化器时更改如何自动确定序列化器字段。</p>
<p>通常，如果 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 默认情况下没有生成你需要的字段，那么您应该将它们显式地添加到类中，或者简单地使用常规的 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类。但是在某些情况下，您可能需要创建一个新的基类，来定义如何为任意给定模型创建序列化字段。</p>
<p><code class="docutils literal notranslate"><span class="pre">.serializer_field_mapping</span></code></p>
<p>Django 模型类到 REST framework 序列化器类的映射。您可以重写此映射以更改应该用于每个模型类的默认序列化器类。</p>
<p><code class="docutils literal notranslate"><span class="pre">.serializer_related_field</span></code></p>
<p>此属性应是序列化器字段类，默认情况下用于关联字段。</p>
<p>对于 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 此属性默认是 <code class="docutils literal notranslate"><span class="pre">PrimaryKeyRelatedField</span></code>。</p>
<p>对于 <code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code> 此属性默认是 <code class="docutils literal notranslate"><span class="pre">serializers.HyperlinkedRelatedField</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">serializer_url_field</span></code></p>
<p>应该用于序列化器上任何 <code class="docutils literal notranslate"><span class="pre">url</span></code> 字段的序列化器字段类。</p>
<p>默认是 <code class="docutils literal notranslate"><span class="pre">serializers.HyperlinkedIdentityField</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">serializer_choice_field</span></code></p>
<p>应用于序列化器上任何选择字段的序列化器字段类。</p>
<p>默认是 <code class="docutils literal notranslate"><span class="pre">serializers.ChoiceField</span></code></p>
<section id="the-field-class-field-kwargs-api">
<h3>The field_class 和 field_kwargs API<a class="headerlink" href="#the-field-class-field-kwargs-api" title="Permalink to this heading">#</a></h3>
<p>调用下面的方法来确定应该自动包含在序列化器中每个字段的类和关键字参数。这些方法都应该返回 <code class="docutils literal notranslate"><span class="pre">(field_class,</span> <span class="pre">field_kwargs)</span></code> 元祖。</p>
<p><code class="docutils literal notranslate"><span class="pre">.build_standard_field(self,</span> <span class="pre">field_name,</span> <span class="pre">model_field)</span></code></p>
<p>调用以生成映射到标准模型字段的序列化器字段。</p>
<p>默认实现返回基于 <code class="docutils literal notranslate"><span class="pre">serializer_field_mapping</span></code> 属性的序列化器类。</p>
<p><code class="docutils literal notranslate"><span class="pre">.build_relational_field(self,</span> <span class="pre">field_name,</span> <span class="pre">relation_info)</span></code></p>
<p>调用以生成映射到关系模型字段的序列化器字段。</p>
<p>默认实现返回基于 <code class="docutils literal notranslate"><span class="pre">serializer_relational_field</span></code> 属性的序列化器类。</p>
<p><code class="docutils literal notranslate"><span class="pre">relation_info</span></code> 参数是一个命名元祖，包含 <code class="docutils literal notranslate"><span class="pre">model_field</span></code>，<code class="docutils literal notranslate"><span class="pre">related_model</span></code>，<code class="docutils literal notranslate"><span class="pre">to_many</span></code> 和 <code class="docutils literal notranslate"><span class="pre">has_through_model</span></code> 属性。</p>
<p><code class="docutils literal notranslate"><span class="pre">.build_nested_field(self,</span> <span class="pre">field_name,</span> <span class="pre">relation_info,</span> <span class="pre">nested_depth)</span></code></p>
<p>当设置了 <code class="docutils literal notranslate"><span class="pre">depth</span></code> 选项时，调用以生成映射到关系模型字段的序列化器字段。</p>
<p>默认实现基于 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 或 <code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code> 动态创建嵌套的序列化器类。</p>
<p><code class="docutils literal notranslate"><span class="pre">nested_depth</span></code> 的值是 <code class="docutils literal notranslate"><span class="pre">depth</span></code> 选项的值减 1。</p>
<p><code class="docutils literal notranslate"><span class="pre">relation_info</span></code> 参数是一个命名元祖，包含 <code class="docutils literal notranslate"><span class="pre">model_field</span></code>，<code class="docutils literal notranslate"><span class="pre">related_model</span></code>，<code class="docutils literal notranslate"><span class="pre">to_many</span></code> 和 <code class="docutils literal notranslate"><span class="pre">has_through_model</span></code> 属性。</p>
<p><code class="docutils literal notranslate"><span class="pre">.build_property_field(self,</span> <span class="pre">field_name,</span> <span class="pre">model_class)</span></code></p>
<p>调用以生成映射到模型类中的属性或零参数方法的序列化器字段。</p>
<p>默认实现返回 <code class="docutils literal notranslate"><span class="pre">ReadOnlyField</span></code> 类。</p>
<p><code class="docutils literal notranslate"><span class="pre">.build_url_field(self,</span> <span class="pre">field_name,</span> <span class="pre">model_class)</span></code></p>
<p>调用为序列化器自己的 <code class="docutils literal notranslate"><span class="pre">url</span></code> 字段生成序列化器字段。默认实现返回 <code class="docutils literal notranslate"><span class="pre">HyperlinkedIdentityField</span></code> 类。</p>
<p><code class="docutils literal notranslate"><span class="pre">.build_unknown_field(self,</span> <span class="pre">field_name,</span> <span class="pre">model_class)</span></code></p>
<p>当字段名称未映射到任何模型字段或模型属性时调用。默认实现会引发错误，但子类可以自定义此行为。</p>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="hyperlinkedmodelserializer">
<h1>HyperlinkedModelSerializer<a class="headerlink" href="#hyperlinkedmodelserializer" title="Permalink to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code> 类类似于 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 类，不同之处在于它使用超链接来表示关联关系而不是主键。</p>
<p>默认情况下，序列化器将包含 <code class="docutils literal notranslate"><span class="pre">url</span></code> 字段而不是主键字段。</p>
<p>url 字段将使用 <code class="docutils literal notranslate"><span class="pre">HyperlinkedIdentityField</span></code> 序列化器字段表示，并且模型上的任何关系将使用 <code class="docutils literal notranslate"><span class="pre">HyperlinkedRelatedField</span></code> 序列化器字段表示。</p>
<p>您可以通过将主键添加到 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 选项显式包含主键，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;account_name&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">)</span>
</pre></div>
</div>
<section id="url-absolute-and-relative-urls">
<h2>绝对和相对 URL (Absolute and relative URLs)<a class="headerlink" href="#url-absolute-and-relative-urls" title="Permalink to this heading">#</a></h2>
<p>当实例化 <code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code> 时，必须在序列化器上下文中包含当前 <code class="docutils literal notranslate"><span class="pre">request</span></code>，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">AccountSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
</pre></div>
</div>
<p>这样做将确保超链接可以包含适当的主机名，以便生成完全限定的 URL，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span>
</pre></div>
</div>
<p>而不是相对 URL，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span>
</pre></div>
</div>
<p>如果您确实想使用相对 URL，应在序列化器上下文中显式传递 <code class="docutils literal notranslate"><span class="pre">{'request'：None}</span></code>。</p>
</section>
<section id="how-hyperlinked-views-are-determined">
<h2>如何确定超链接视图 (How hyperlinked views are determined)<a class="headerlink" href="#how-hyperlinked-views-are-determined" title="Permalink to this heading">#</a></h2>
<p>需要有一种方法来确定应该将哪些视图用于超链接到模型实例。</p>
<p>默认情况下，超链接预期对应于匹配样式 <code class="docutils literal notranslate"><span class="pre">{model_name}-detail</span></code> 的视图名，并通过 <code class="docutils literal notranslate"><span class="pre">pk</span></code> 关键字参数查找实例。</p>
<p>你可以使用在 <code class="docutils literal notranslate"><span class="pre">extra_kwargs</span></code> 设置中的 <code class="docutils literal notranslate"><span class="pre">view_name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">lookup_field</span></code> 选项中的一个或两个来重写 URL 字段视图名称和查询字段。如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;account_url&#39;</span><span class="p">,</span> <span class="s1">&#39;account_name&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">)</span>
        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;view_name&#39;</span><span class="p">:</span> <span class="s1">&#39;accounts&#39;</span><span class="p">,</span> <span class="s1">&#39;lookup_field&#39;</span><span class="p">:</span> <span class="s1">&#39;account_name&#39;</span><span class="p">},</span>
            <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lookup_field&#39;</span><span class="p">:</span> <span class="s1">&#39;username&#39;</span><span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>或者，您可以显式设置序列化器上的字段。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedIdentityField</span><span class="p">(</span>
        <span class="n">view_name</span><span class="o">=</span><span class="s1">&#39;accounts&#39;</span><span class="p">,</span>
        <span class="n">lookup_field</span><span class="o">=</span><span class="s1">&#39;slug&#39;</span>
    <span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedRelatedField</span><span class="p">(</span>
        <span class="n">view_name</span><span class="o">=</span><span class="s1">&#39;user-detail&#39;</span><span class="p">,</span>
        <span class="n">lookup_field</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">,</span>
        <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;account_name&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>提示</strong>：正确匹配超链接表示和你的URL配置有时可能会有点困难。打印 <code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code> 实例的 <code class="docutils literal notranslate"><span class="pre">repr</span></code> 是特别有用的方式来检查关联关系预映射到哪些视图名称和查询字段。</p>
</section>
<hr class="docutils" />
<section id="url-changing-the-url-field-name">
<h2>更改 URL 字段名称 (Changing the URL field name)<a class="headerlink" href="#url-changing-the-url-field-name" title="Permalink to this heading">#</a></h2>
<p>URL 字段的名称默认为 ‘url’。你可以通过使用 <code class="docutils literal notranslate"><span class="pre">URL_FIELD_NAME</span></code> 设置 (在 settings 文件) 进行全局覆盖。</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="listserializer">
<h1>ListSerializer<a class="headerlink" href="#listserializer" title="Permalink to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 类提供同时序列化和验证多个对象的行为。您通常不需要直接使用 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code>，而应该在实例化序列化器时简单地传递 <code class="docutils literal notranslate"><span class="pre">many=True</span></code>。</p>
<p>当序列化器被实例化并且 <code class="docutils literal notranslate"><span class="pre">many</span> <span class="pre">=</span> <span class="pre">True</span></code> 被传递时，<code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 实例将被创建。然后，序列化器类将成为 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 的子类。</p>
<p>以下参数也可以传递给 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 字段或者被传递 <code class="docutils literal notranslate"><span class="pre">many=True</span></code> 参数的序列化器。</p>
<p><code class="docutils literal notranslate"><span class="pre">allow_empty</span></code></p>
<p>默认情况下为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，但如果要禁止空列表作为有效输入，则可以设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
<section id="listserializer-customizing-listserializer-behavior">
<h2>自定义 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 行为 (Customizing <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> behavior)<a class="headerlink" href="#listserializer-customizing-listserializer-behavior" title="Permalink to this heading">#</a></h2>
<p>当您可能想要自定义 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 行为时，有一些用例。例如：</p>
<ul class="simple">
<li><p>你想要提供列表的特定验证，例如检查一个元素是否与列表中的另外一个元素冲突。</p></li>
<li><p>你想要自定义多个对象的创建或更新行为。</p></li>
</ul>
<p>对于这些情况，您可以通过使用序列化器 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 类中的 <code class="docutils literal notranslate"><span class="pre">list_serializer_class</span></code> 选项来修改传递 <code class="docutils literal notranslate"><span class="pre">many=True</span></code> 时使用的类。</p>
<p>例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomListSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ListSerializer</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">CustomSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">list_serializer_class</span> <span class="o">=</span> <span class="n">CustomListSerializer</span>
</pre></div>
</div>
<section id="customizing-multiple-create">
<h3>自定义多重创建 (Customizing multiple create)<a class="headerlink" href="#customizing-multiple-create" title="Permalink to this heading">#</a></h3>
<p>多个对象的创建默认实现是简单地为列表中的每个项目调用 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 。如果想要自定义该行为，那么您需要自定义当被传递 <code class="docutils literal notranslate"><span class="pre">many=True</span></code> 参数时使用的 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 类中的 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 方法。</p>
<p>例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookListSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ListSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">books</span> <span class="o">=</span> <span class="p">[</span><span class="n">Book</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">validated_data</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">bulk_create</span><span class="p">(</span><span class="n">books</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BookSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">list_serializer_class</span> <span class="o">=</span> <span class="n">BookListSerializer</span>
</pre></div>
</div>
</section>
<section id="customizing-multiple-update">
<h3>自定义多个更新 (Customizing multiple update)<a class="headerlink" href="#customizing-multiple-update" title="Permalink to this heading">#</a></h3>
<p>默认情况下，<code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 类不支持多个更新。这是因为插入和删除预期的行为不明确。</p>
<p>为了支持多个更新，您需要明确地进行这样的操作。编写多个更新代码时，请务必记住以下几点：</p>
<ul class="simple">
<li><p>如何确定为数据列表中的每个 item 更新哪个实例？</p></li>
<li><p>如何处理插入？它们是无效的，还是创建新对象？</p></li>
<li><p>如何处理删除？它们是暗示删除对象还是删除关系？它们应该被忽略，还是无效？</p></li>
<li><p>如何处理排序？改变两个项目的位置是否意味着任何状态改变或被忽略？</p></li>
</ul>
<p>你需要向实例序列化器显式添加 <code class="docutils literal notranslate"><span class="pre">id</span></code> 字段。默认隐式生成的 <code class="docutils literal notranslate"><span class="pre">id</span></code> 字段被标记为 <code class="docutils literal notranslate"><span class="pre">read_only</span></code>。这会导致它在更新时被删除。一旦你显式地声明它，它将在列表序列化器的 <code class="docutils literal notranslate"><span class="pre">update</span></code> 方法中可用。</p>
<p>以下是您可以选择实施多个更新的示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookListSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ListSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="c1"># id-&gt;instance 和 id-&gt;data item 的映射。</span>
        <span class="n">book_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">book</span> <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">}</span>
        <span class="n">data_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">validated_data</span><span class="p">}</span>

        <span class="c1"># 执行创建和更新。</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">book_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">book_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">book_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">book</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

        <span class="c1"># 执行删除</span>
        <span class="k">for</span> <span class="n">book_id</span><span class="p">,</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">book_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">book_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_mapping</span><span class="p">:</span>
                <span class="n">book</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ret</span>

<span class="k">class</span> <span class="nc">BookSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="c1"># 我们需要使用主键识别列表中的元素，</span>
    <span class="c1"># 所以在这里使用一个可写字段，而不是默认的只读字段。</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="o">...</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">list_serializer_class</span> <span class="o">=</span> <span class="n">BookListSerializer</span>
</pre></div>
</div>
<p>第三方包可能包括在 3.1 版本中，它为多个更新操作提供一些自动支持，类似于 REST framework 2 中存在的 <code class="docutils literal notranslate"><span class="pre">allow_add_remove</span></code> 行为。</p>
</section>
<section id="listserializer-customizing-listserializer-initialization">
<h3>自定义 ListSerializer 初始化 (Customizing ListSerializer initialization)<a class="headerlink" href="#listserializer-customizing-listserializer-initialization" title="Permalink to this heading">#</a></h3>
<p>当带有 <code class="docutils literal notranslate"><span class="pre">many=True</span></code> 的序列化器被实例化时，我们需要确定哪些参数和关键字参数应该被传递给子类 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 和父类 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 的 <code class="docutils literal notranslate"><span class="pre">.__init__()</span></code> 方法。</p>
<p>默认实现是将所有参数传递给两个类，除了 <code class="docutils literal notranslate"><span class="pre">validators</span></code> 和任何自定义关键字参数，这两个参数都假定是用于子类序列化器的。</p>
<p>偶尔，您可能需要显式的指定当被传递 <code class="docutils literal notranslate"><span class="pre">many=True</span></code> 参数时，子类和父类应该如何实例化。您可以使用 <code class="docutils literal notranslate"><span class="pre">many_init</span></code> 类方法执行此操作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">many_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Instantiate the child serializer.</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="c1"># Instantiate the parent list serializer.</span>
        <span class="k">return</span> <span class="n">CustomListSerializer</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="baseserializer">
<h1>BaseSerializer<a class="headerlink" href="#baseserializer" title="Permalink to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">BaseSerialAlgisher</span></code> 类，可以用来方便地支持可选的序列化和反序列化样式。</p>
<p>该类实现与 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类相同的基本 API：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.data</span></code> —— 返回传出的基元表示。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.is_valid()</span></code> —— 反序列化并验证传入的数据。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.validated_data</span></code> —— 返回经过验证的传入数据。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.errors</span></code> —— 返回在验证期间的任何错误。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.save()</span></code> —— 将验证的数据保存到对象实例中。</p></li>
</ul>
<p>可以重写四种方法，这取决于你希望序列化器类支持的功能：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.to_representation()</span></code> —— 重写它以支持序列化，用于读取操作。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.to_internal_value()</span></code> —— 重写它以支持反序列化，以用于写入操作。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> —— 重写其中一个或两个以支持保存实例。</p></li>
</ul>
<p>因为此类提供了与 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 类相同的接口，所以您可以像使用常规的 <code class="docutils literal notranslate"><span class="pre">Serializer</span></code> 或 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 一样使用现有的通用的基于类的视图。</p>
<p>在执行此操作时您将注意到的唯一区别是 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类不会在可浏览的 API 中生成 HTML 表单。这是因为它们返回的数据不包括允许每个字段被渲染成合适的 HTML 输入的所有字段信息。</p>
<section id="baseserializer-read-only-baseserializer-classes">
<h2>只读 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类(Read-only <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> classes)<a class="headerlink" href="#baseserializer-read-only-baseserializer-classes" title="Permalink to this heading">#</a></h2>
<p>使用 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类来实现只读序列化器，我们只需要重写 <code class="docutils literal notranslate"><span class="pre">.to_representation()</span></code> 方法。让我们看一个使用简单 Django 模型的示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HighScore</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">player_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</pre></div>
</div>
<p>创建只读序列化器将 <code class="docutils literal notranslate"><span class="pre">HighScore</span></code> 实例转换为原始数据类型很简单。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HighScoreSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">BaseSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
            <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">player_name</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>我们现在可以使用此类来序列化单个 <code class="docutils literal notranslate"><span class="pre">HighScore</span></code> 实例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@api_view</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">high_score</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">HighScore</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="n">HighScoreSerializer</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>或者使用它来序列化多个实例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@api_view</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">all_high_scores</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">HighScore</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-score&#39;</span><span class="p">)</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="n">HighScoreSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="baseserializer-read-write-baseserializer-classes">
<h2>读写 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类 (Read-write <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> classes)<a class="headerlink" href="#baseserializer-read-write-baseserializer-classes" title="Permalink to this heading">#</a></h2>
<p>要创建读写序列化器，我们首先需要实现 <code class="docutils literal notranslate"><span class="pre">.to_internal_value()</span></code> 方法。此方法返回将用于构造对象实例的验证值，如果提供的数据格式不正确，则可能引发 <code class="docutils literal notranslate"><span class="pre">serializers.ValidationError</span></code>。</p>
<p>一旦实现 <code class="docutils literal notranslate"><span class="pre">.to_internal_value()</span></code>，基本验证 API 将在序列化器中可用，并且您将能够使用 <code class="docutils literal notranslate"><span class="pre">.is_valid()</span></code>，<code class="docutils literal notranslate"><span class="pre">.validated_data</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.errors</span></code>。</p>
<p>如果还想支持 <code class="docutils literal notranslate"><span class="pre">.save()</span></code>，您还需要实现 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法中的一个或两个。</p>
<p>这是我们之前的 <code class="docutils literal notranslate"><span class="pre">HighScoreSerializer</span></code> 的完整示例，它已经更新以支持读写操作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HighScoreSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">BaseSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_internal_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">)</span>
        <span class="n">player_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;player_name&#39;</span><span class="p">)</span>

        <span class="c1"># 执行数据验证。</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">score</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">({</span>
                <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="s1">&#39;This field is required.&#39;</span>
            <span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">player_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">({</span>
                <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="s1">&#39;This field is required.&#39;</span>
            <span class="p">})</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">player_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">({</span>
                <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="s1">&#39;May not be more than 10 characters.&#39;</span>
            <span class="p">})</span>

        <span class="c1"># 返回验证值。这将作为可用的 `.validated_data` 属性。</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">score</span><span class="p">),</span>
            <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">player_name</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
            <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">player_name</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HighScore</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-new-base-classes">
<h2>创建新的基类 (Creating new base classes)<a class="headerlink" href="#creating-new-base-classes" title="Permalink to this heading">#</a></h2>
<p>如果您想要实现新的通用序列化器类来处理特定的序列化样式，或者集成其他存储后端，那么 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类也很有用。</p>
<p>以下类是可以处理将任意对象强制转换为基本表示的通用序列化器的示例。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ObjectSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">BaseSerializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    任意复杂对象强制转换为原始表示的只读序列化器。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attribute_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attribute_name</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="c1"># 忽略私有属性。</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                <span class="c1"># 忽略方法和其他 callables。</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
                <span class="c1"># 原始类型可以通过未修改的方式传递。</span>
                <span class="n">output</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># 递归处理列表中的项。</span>
                <span class="n">output</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">attribute</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># 递归处理字典中的项。</span>
                <span class="n">output</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attribute</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 将其他内容强制到其字符串表示形式。</span>
                <span class="n">output</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="advanced-serializer-usage">
<h1>高级序列化器用法 (Advanced serializer usage)<a class="headerlink" href="#advanced-serializer-usage" title="Permalink to this heading">#</a></h1>
<section id="overriding-serialization-and-deserialization-behavior">
<h2>重写序列化和反序列化行为 (Overriding serialization and deserialization behavior)<a class="headerlink" href="#overriding-serialization-and-deserialization-behavior" title="Permalink to this heading">#</a></h2>
<p>如果需要更改序列化器类的序列化或反序列化行为，可以通过重写 <code class="docutils literal notranslate"><span class="pre">.to_representation()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.to_internal_value()</span></code> 方法来实现。</p>
<p>可能有用的一些原因包括…</p>
<ul class="simple">
<li><p>为新的序列化器基类添加新行为。</p></li>
<li><p>对现有类稍微修改行为。</p></li>
<li><p>提高频繁访问返回大量数据的 API 端点的序列化性能。</p></li>
</ul>
<p>这些方法的明显特征如下：</p>
<p><code class="docutils literal notranslate"><span class="pre">.to_representation(self,</span> <span class="pre">obj)</span></code></p>
<p>获取需要序列化的对象实例，并返回原始表示。通常，这意味着返回内置 Python 数据类型的结构。可以处理的确切类型取决于为 API 配置的渲染器类。</p>
<p>可以重写以修改表示样式。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert `username` to lowercase.&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.to_internal_value(self,</span> <span class="pre">data)</span></code></p>
<p>将未经验证的传入数据作为输入，并返回可用的已验证数据作为 <code class="docutils literal notranslate"><span class="pre">serializer.validated_data</span></code> 。如果在序列化器类上调用 <code class="docutils literal notranslate"><span class="pre">.save()</span></code>，则返回值也将传递给 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法。</p>
<p>如果任何验证失败，则该方法应引发 <code class="docutils literal notranslate"><span class="pre">serializers.ValidationError(errors)</span></code>。<code class="docutils literal notranslate"><span class="pre">errors</span></code> 参数应该是将字段名称 (或 <code class="docutils literal notranslate"><span class="pre">settings.NON_FIELD_ERRORS_KEY</span></code> ) 映射到错误消息列表的字典。如果您不需要改变反序列化行为，而是想提供对象级验证，则建议改为重写 <code class="docutils literal notranslate"><span class="pre">.validate()</span></code> 方法。</p>
<p>传递给此方法的 <code class="docutils literal notranslate"><span class="pre">data</span></code> 参数通常是 <code class="docutils literal notranslate"><span class="pre">request.data</span></code> 的值，因此它提供的数据类型将取决于为 API 配置的解析器类。</p>
</section>
<section id="serializer-inheritance">
<h2>序列化器继承 (Serializer Inheritance)<a class="headerlink" href="#serializer-inheritance" title="Permalink to this heading">#</a></h2>
<p>与 Django 表单类似，您可以通过继承来扩展和重用序列化器。这允许您在父类上声明一组通用的字段或方法，然后可以在多个序列化器中使用它们。例如，</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBaseSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">my_field</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validate_my_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">MySerializer</span><span class="p">(</span><span class="n">MyBaseSerializer</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>与 Django 的 <code class="docutils literal notranslate"><span class="pre">Model</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> 类一样，序列化器内部 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 类不会隐式地继承它父类内部 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 类。如果您想要从父类继承 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 类，则必须明确地这样做。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">MyBaseSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">MyBaseSerializer</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
</pre></div>
</div>
<p>通常我们建议不要在内部 Meta 类上使用继承，而是显式声明所有选项。</p>
<p>此外，以下注意事项适用于序列化程序继承：</p>
<ul class="simple">
<li><p>正常的 Python 名称解析规则适用。如果您有多个声明 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 内部类的基类，则只使用第一个类。这意味着子类的 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> (如果存在)，否则是第一个父类的 <code class="docutils literal notranslate"><span class="pre">Meta</span></code>。</p></li>
<li><p>通过在子类上将名称设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，声明性地删除继承自父类的 <code class="docutils literal notranslate"><span class="pre">Field</span></code> 是可能的。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBaseSerializer</span><span class="p">(</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">my_field</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">MySerializer</span><span class="p">(</span><span class="n">MyBaseSerializer</span><span class="p">):</span>
    <span class="n">my_field</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>但是，您只能使用这种技术选择从父类声明性定义的字段；它不会阻止 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 生成默认字段。要从默认字段中选择，请参阅<a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#specifying-which-fields-to-include">指定要包括的字段</a>。</p>
</section>
<section id="dynamically-modifying-fields">
<h2>动态修改字段 (Dynamically modifying fields)<a class="headerlink" href="#dynamically-modifying-fields" title="Permalink to this heading">#</a></h2>
<p>一旦序列化器已初始化，可以使用 <code class="docutils literal notranslate"><span class="pre">.field</span></code> 属性访问序列化器上设置的字段字典。访问和修改此属性允许您动态修改序列化器。</p>
<p>直接修改 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 参数允许您做一些有趣的事情，例如在运行时更改序列化器字段上的参数，而不是在声明序列化器时。</p>
<section id="id1">
<h3>举个栗子<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>例如，如果您希望能够设置序列化器在初始化时应使用哪些字段，您可以创建一个像这样的序列化器类：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DynamicFieldsModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ModelSerializer 获取额外的 `fields` 参数来控制哪些字段应该被显示。</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># 不要将 &#39;fields&#39; 参数传递给超类</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fields&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># 通常实例化超类</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DynamicFieldsModelSerializer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># 删除`fields`参数中未指定的任何字段。</span>
            <span class="n">allowed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">existing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">existing</span> <span class="o">-</span> <span class="n">allowed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</pre></div>
</div>
<p>这将允许您执行以下操作：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">DynamicFieldsModelSerializer</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="go">{&#39;id&#39;: 2, &#39;username&#39;: &#39;jonwatts&#39;, &#39;email&#39;: &#39;jon@example.com&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
<span class="go">{&#39;id&#39;: 2, &#39;email&#39;: &#39;jon@example.com&#39;}</span>
</pre></div>
</div>
</section>
</section>
<section id="customizing-the-default-fields">
<h2>自定义默认字段 (Customizing the default fields)<a class="headerlink" href="#customizing-the-default-fields" title="Permalink to this heading">#</a></h2>
<p>REST framework 2 提供了一个 API，允许开发人员重写如何自动生成默认字段集的 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> 类。</p>
<p>该 API 包括 <code class="docutils literal notranslate"><span class="pre">.get_field()</span></code>，<code class="docutils literal notranslate"><span class="pre">.</span> <span class="pre">get_pk_field()</span></code> 和其他方法。</p>
<p>因为版本 3.0 序列化器已经从根本上重新设计了，这个 API 不再存在。您仍然可以修改已创建的字段，但您需要参考源代码，并且注意，如果所做的更改是针对 API 的私有位，那么它们可能会发生更改。</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="third-party-packages">
<h1>第三方包 (Third party packages)<a class="headerlink" href="#third-party-packages" title="Permalink to this heading">#</a></h1>
<p>以下是可用的第三方包。</p>
<section id="django-rest-marshmallow">
<h2>Django REST marshmallow<a class="headerlink" href="#django-rest-marshmallow" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://marshmallow-code.github.io/django-rest-marshmallow/">django-rest-marshmallow</a> 包使用 python <a class="reference external" href="https://marshmallow.readthedocs.io/en/latest/">marshmallow</a> 库为序列化器提供了另一种实现方式。它公开了与 REST framework 序列化器相同的 API，并且可以在某些用例中用作替代品。</p>
</section>
<section id="serpy">
<h2>Serpy<a class="headerlink" href="#serpy" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/clarkduvall/serpy">serpy</a> 包是为速度而构建的序列化器的另一种实现。Serpy 将复杂数据类型序列化为简单的原生类型。原生类型可以轻松转换为 JSON 或任何其他所需格式。</p>
</section>
<section id="mongoenginemodelserializer">
<h2>MongoengineModelSerializer<a class="headerlink" href="#mongoenginemodelserializer" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/umutbozkurt/django-rest-framework-mongoengine">django-rest-framework-mongoengine</a> 包提供了一个支持 MongoDB 作为 Django REST framework 的存储层的 <code class="docutils literal notranslate"><span class="pre">MongoEngineModelSerializer</span></code> 序列化器类。</p>
</section>
<section id="geofeaturemodelserializer">
<h2>GeoFeatureModelSerializer<a class="headerlink" href="#geofeaturemodelserializer" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/djangonauts/django-rest-framework-gis">django-rest-framework-gis</a> 包提供了一个支持 GeoJSON 进行读写操作的 <code class="docutils literal notranslate"><span class="pre">GeoFeatureModelSerializer</span></code> 序列化器类。</p>
</section>
<section id="hstoreserializer">
<h2>HStoreSerializer<a class="headerlink" href="#hstoreserializer" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/djangonauts/django-rest-framework-hstore">django-rest-framework-hstore</a> 包提供了一个 <code class="docutils literal notranslate"><span class="pre">HStoreSerializer</span></code> 来支持 <a class="reference external" href="https://github.com/djangonauts/django-hstore">django-hstore</a> <code class="docutils literal notranslate"><span class="pre">DictionaryField</span></code> 模型字段及其 <code class="docutils literal notranslate"><span class="pre">schema-mode</span></code> 特点。</p>
</section>
<section id="dynamic-rest">
<h2>Dynamic REST<a class="headerlink" href="#dynamic-rest" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/AltSchool/dynamic-rest">dynamic-rest</a> 包扩展了 ModelSerializer 和 ModelViewSet 接口，添加了 API 查询参数，用于过滤，排序和包含/排除序列化器定义的所有字段和关系。</p>
</section>
<section id="dynamic-fields-mixin">
<h2>Dynamic Fields Mixin<a class="headerlink" href="#dynamic-fields-mixin" title="Permalink to this heading">#</a></h2>
<p>drf-dynamic-fields 包提供了一个 mixin 来动态地限制每个序列化器的字段到 URL 参数指定的子集。</p>
</section>
<section id="drf-flexfields">
<h2>DRF FlexFields<a class="headerlink" href="#drf-flexfields" title="Permalink to this heading">#</a></h2>
<p>drf-flex-fields 包扩展了 ModelSerializer 和 ModelViewSet，以提供常用的功能，用于动态设置字段并将原始字段扩展到嵌套模型，它们都来自 URL 参数和序列化器类定义。</p>
</section>
<section id="serializer-extensions">
<h2>Serializer Extensions<a class="headerlink" href="#serializer-extensions" title="Permalink to this heading">#</a></h2>
<p>django-rest-framework-serializer-extensions 包提供了一系列工具来干扰序列化器，通过允许在每个视图/请求的基础上定义的字段。字段可以列入白名单，列入黑名单，并且可以选择的扩展子序列化器。</p>
</section>
<section id="html-json-forms">
<h2>HTML JSON Forms<a class="headerlink" href="#html-json-forms" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/wq/html-json-forms">html-json-forms</a> 包提供了一个算法和序列化器，用于按照 (非活动) <a class="reference external" href="https://www.w3.org/TR/html-json-forms/">HTML JSON 表单规范</a>处理 <code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code> 提交。序列化器有助于在 HTML 中处理任意嵌套的 JSON 结构。例如，<code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">name=&quot;items[0][id]&quot;</span> <span class="pre">value=&quot;5&quot;&gt;</span></code> 将被解释为 <code class="docutils literal notranslate"><span class="pre">{&quot;items&quot;:</span> <span class="pre">[{&quot;id&quot;:</span> <span class="pre">&quot;5&quot;}]}</span></code>。</p>
</section>
<section id="drf-base64">
<h2>DRF-Base64<a class="headerlink" href="#drf-base64" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://bitbucket.org/levit_scs/drf_base64">DRF-Base64</a> 提供了一组字段和模型序列化器，用于处理 base64 编码文件的上传。</p>
</section>
<section id="queryfields">
<h2>QueryFields<a class="headerlink" href="#queryfields" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://djangorestframework-queryfields.readthedocs.io/">djangorestframework-queryfields</a> 允许 API 客户端通过包含/排除查询参数指定将在响应中发送的字段。</p>
</section>
<section id="drf-writable-nested">
<h2>DRF Writable Nested<a class="headerlink" href="#drf-writable-nested" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/beda-software/drf-writable-nested">drf-writable-nested</a> 包提供可写的嵌套模型序列化器，允许使用嵌套的相关数据创建/更新模型。</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./API-Guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Renderers.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">渲染器 (Renderers)</p>
      </div>
    </a>
    <a class="right-next"
       href="Serializer-fields.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">序列化器字段 (Serializer fields)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">序列化器 (Serializers)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#declaring-serializers">声明序列化器 (Declaring Serializers)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializing-objects">序列化对象 (Serializing objects)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deserializing-objects">反序列化对象 (Deserializing objects)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-instances">保存实例 (Saving instances)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-passing-additional-attributes-to-save">将附加属性传递给 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> (Passing additional attributes to <code class="docutils literal notranslate"><span class="pre">.save()</span></code>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-overriding-save-directly">直接重写 <code class="docutils literal notranslate"><span class="pre">.save()</span></code> (Overriding <code class="docutils literal notranslate"><span class="pre">.save()</span></code> directly.)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">验证 (Validation)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raising-an-exception-on-invalid-data">引发无效数据的异常 (Raising an exception on invalid data)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#field-level-validation">字段级别验证 (Field-level validation)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#object-level-validation">对象级别验证 (Object-level validation)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validators">验证器 (Validators)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-initial-data-and-instance">访问初始数据和实例 (Accessing the initial data and instance)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-updates">部分更新 (Partial updates)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-nested-objects">处理嵌套对象 (Dealing with nested objects)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writable-nested-representations">可写的嵌套表示 (Writable nested representations)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-writing-create-methods-for-nested-representations">为嵌套表示编写 <code class="docutils literal notranslate"><span class="pre">.create()</span></code> 方法 (Writing <code class="docutils literal notranslate"><span class="pre">.create()</span></code> methods for nested representations)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-writing-update-methods-for-nested-representations">为嵌套表示编写 <code class="docutils literal notranslate"><span class="pre">.update()</span></code> 方法 (Writing <code class="docutils literal notranslate"><span class="pre">.update()</span></code> methods for nested representations)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-saving-related-instances-in-model-manager-classes">处理在模型管理类中保存关联实例 (Handling saving related instances in model manager classes)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-multiple-objects">处理多个对象 (Dealing with multiple objects)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#serializing-multiple-objects">序列化多个对象 (Serializing multiple objects)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deserializing-multiple-objects">反序列化多个对象 (Deserializing multiple objects)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#including-extra-context">包括额外的上下文 (Including extra context)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelserializer">ModelSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelserializer-inspecting-a-modelserializer">检查 <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code> (Inspecting a <code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code>)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-which-fields-to-include">指定要包含的字段 (Specifying which fields to include)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-nested-serialization">指定嵌套序列化 (Specifying nested serialization)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-fields-explicitly">显式指定字段 (Specifying fields explicitly)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-read-only-fields">指定只读字段 (Specifying read only fields)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-keyword-arguments">附加关键字参数 (Additional keyword arguments)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-fields">关系字段 (Relational fields)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-field-mappings">自定义字段映射 (Customizing field mappings)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-field-class-field-kwargs-api">The field_class 和 field_kwargs API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperlinkedmodelserializer">HyperlinkedModelSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#url-absolute-and-relative-urls">绝对和相对 URL (Absolute and relative URLs)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-hyperlinked-views-are-determined">如何确定超链接视图 (How hyperlinked views are determined)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#url-changing-the-url-field-name">更改 URL 字段名称 (Changing the URL field name)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#listserializer">ListSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#listserializer-customizing-listserializer-behavior">自定义 <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> 行为 (Customizing <code class="docutils literal notranslate"><span class="pre">ListSerializer</span></code> behavior)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-multiple-create">自定义多重创建 (Customizing multiple create)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-multiple-update">自定义多个更新 (Customizing multiple update)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#listserializer-customizing-listserializer-initialization">自定义 ListSerializer 初始化 (Customizing ListSerializer initialization)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#baseserializer">BaseSerializer</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseserializer-read-only-baseserializer-classes">只读 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类(Read-only <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> classes)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseserializer-read-write-baseserializer-classes">读写 <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> 类 (Read-write <code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> classes)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-base-classes">创建新的基类 (Creating new base classes)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-serializer-usage">高级序列化器用法 (Advanced serializer usage)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overriding-serialization-and-deserialization-behavior">重写序列化和反序列化行为 (Overriding serialization and deserialization behavior)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializer-inheritance">序列化器继承 (Serializer Inheritance)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamically-modifying-fields">动态修改字段 (Dynamically modifying fields)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">举个栗子</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-the-default-fields">自定义默认字段 (Customizing the default fields)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#third-party-packages">第三方包 (Third party packages)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#django-rest-marshmallow">Django REST marshmallow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serpy">Serpy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mongoenginemodelserializer">MongoengineModelSerializer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geofeaturemodelserializer">GeoFeatureModelSerializer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hstoreserializer">HStoreSerializer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-rest">Dynamic REST</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-fields-mixin">Dynamic Fields Mixin</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drf-flexfields">DRF FlexFields</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializer-extensions">Serializer Extensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#html-json-forms">HTML JSON Forms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drf-base64">DRF-Base64</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#queryfields">QueryFields</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drf-writable-nested">DRF Writable Nested</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>